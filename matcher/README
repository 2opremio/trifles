
After a tweet ( https://twitter.com/veorq/status/637616767058223104 ), I wanted
to see if my suggestion if generating a finite state machine with ragel was
actually faster.

Turns out it wasn't.

At least not for only 1000 keys anyway.  Ragel segfaulted when trying to create
a machine for 200,000 keys. :(

I also tested armon/go-radix and cloudflare/ahocorasick.

My test keys were the top 1000 email domains from the Linkedin leak a while ago.
I've been using it as a reasonable real-world test set every since I watched
John Graham-Cumming's talk https://www.youtube.com/watch?v=_41bkNr7eik

Anyways, searching 200000 inputs for the thousand keys 10 times; we see the ranking

<dgryski@kaepora[matcher] \ʕ◔ϖ◔ʔ/ > for i in aho radix bsearch ragel map; do ./matcher -f ./alldomains.txt -which $i; done
2015/09/01 10:16:43 using matcher=aho
2015/09/01 10:16:51 time.Since(t0)=8.176484155s
2015/09/01 10:16:51 found=16274730
2015/09/01 10:17:01 using matcher=radix
2015/09/01 10:17:07 time.Since(t0)=6.394209304s
2015/09/01 10:17:07 found=15965200
2015/09/01 10:17:16 using matcher=bsearch
2015/09/01 10:17:21 time.Since(t0)=4.688366242s
2015/09/01 10:17:21 found=15965200
2015/09/01 10:17:34 using matcher=ragel
2015/09/01 10:17:36 time.Since(t0)=2.177903598s
2015/09/01 10:17:36 found=15965200
2015/09/01 10:17:47 using matcher=map
2015/09/01 10:17:48 time.Since(t0)=829.90869ms
2015/09/01 10:17:48 found=15965200
